{"remainingRequest":"/Users/jayson/Desktop/work/DDM-admin/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jayson/Desktop/work/DDM-admin/src/views/admin/monitor/server/components/LineChart.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/jayson/Desktop/work/DDM-admin/src/views/admin/monitor/server/components/LineChart.vue","mtime":1720245294021},{"path":"/Users/jayson/Desktop/work/DDM-admin/node_modules/cache-loader/dist/cjs.js","mtime":1720245288376},{"path":"/Users/jayson/Desktop/work/DDM-admin/node_modules/babel-loader/lib/index.js","mtime":1720245285342},{"path":"/Users/jayson/Desktop/work/DDM-admin/node_modules/cache-loader/dist/cjs.js","mtime":1720245288376},{"path":"/Users/jayson/Desktop/work/DDM-admin/node_modules/vue-loader/lib/index.js","mtime":1720245293567}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBWdWVUeXBlcyBmcm9tICJ2dWUtdHlwZXMiOwovLyDlvJXlhaXln7rmnKzmqKHmnb8s5oyJ6ZyA5Yqg6L29CmltcG9ydCBlY2hhcnRzIGZyb20gImVjaGFydHMiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCB7IGdldE1vbml0b3JMb2dzIH0gZnJvbSAiQC9hcGkvYWRtaW4vbW9uaXRvci9zZXJ2ZXIiOwoKY29uc3QgVE9EQVkgPSBtb21lbnQoKS5mb3JtYXQoIllZWVktTU0tREQiKTsKY29uc3QgWUVTVEVSREFZID0gbW9tZW50KCkuc3VidHJhY3QoMSwgImRheXMiKS5mb3JtYXQoIllZWVktTU0tREQiKTsKY29uc3QgTEFTVF9TRVZFTl9EQVlTID0gbW9tZW50KCkuc3VidHJhY3QoNywgImRheXMiKS5mb3JtYXQoIllZWVktTU0tREQiKTsKY29uc3QgTEFTVF9USElSVFlfREFZUyA9IG1vbWVudCgpLnN1YnRyYWN0KDMwLCAiZGF5cyIpLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwoKLy8g5pe26Ze05q61562b6YCJ6YWN572uCmNvbnN0IFRJTUVfTElNSVRfU0VUVElORyA9IHsKICAieWVzdGVyZGF5IjogewogICAga2V5OiAieWVzdGVyZGF5IiwKICAgIG5hbWU6ICLmmKjlpKkiLAogICAgdGltZVJhbmdlOiBbCiAgICAgIGAke1lFU1RFUkRBWX0gMDA6MDA6MDBgLAogICAgICBgJHtZRVNURVJEQVl9IDIzOjU5OjU5YAogICAgXQogIH0sCiAgInRvZGF5IjogewogICAga2V5OiAidG9kYXkiLAogICAgbmFtZTogIuS7iuWkqSIsCiAgICB0aW1lUmFuZ2U6IFsKICAgICAgYCR7VE9EQVl9IDAwOjAwOjAwYCwKICAgICAgYCR7VE9EQVl9IDIzOjU5OjU5YAogICAgXQogIH0sCiAgImxhdGVzdFdlZWsiOiB7CiAgICBrZXk6ICJsYXRlc3RXZWVrIiwKICAgIG5hbWU6ICLmnIDov5E35aSpIiwKICAgIHRpbWVSYW5nZTogWwogICAgICBgJHtMQVNUX1NFVkVOX0RBWVN9IDAwOjAwOjAwYCwKICAgICAgYCR7VE9EQVl9IDIzOjU5OjU5YAogICAgXQogIH0sCiAgImxhdGVzdE1vbnRoIjogewogICAga2V5OiAibGF0ZXN0TW9udGgiLAogICAgbmFtZTogIuacgOi/kTMw5aSpIiwKICAgIHRpbWVSYW5nZTogWwogICAgICBgJHtMQVNUX1RISVJUWV9EQVlTfSAwMDowMDowMGAsCiAgICAgIGAke1RPREFZfSAyMzo1OTo1OWAKICAgIF0KICB9Cn07Ci8vIOm7mOiupOaYvuekuuaXtumXtApjb25zdCBERUZBVUxUX1RJTUUgPSAi5LuK5aSpIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTGluZUNoYXJ0IiwKICBwcm9wczogewogICAgc2VydmVySW5mbzogVnVlVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsCiAgICBsaW5lQ2hhcnRLZXk6IFZ1ZVR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLAogICAgY2hhcnRUaXRsZTogVnVlVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsCiAgICBjaGFydERhdGE6IFZ1ZVR5cGVzLmFycmF5LmlzUmVxdWlyZWQsCiAgICBjaGFydFRpbWU6IFZ1ZVR5cGVzLmFycmF5LmlzUmVxdWlyZWQKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBUSU1FX0xJTUlUX1NFVFRJTkcsCiAgICAgIHRpbWVMaW1pdDogREVGQVVMVF9USU1FLAogICAgICBsaW5lQ2hhcnRJZDogdGhpcy5saW5lQ2hhcnRLZXkgKyAiQ2hhcnQiLAogICAgICBsaW5lQ2hhcnREYXRhOiB0aGlzLmNoYXJ0RGF0YSwKICAgICAgbGluZUNoYXJ0VGltZTogdGhpcy5jaGFydFRpbWUKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgdGltZUxpbWl0TmFtZXMoKSB7CiAgICAgIHJldHVybiBPYmplY3Qua2V5cyhUSU1FX0xJTUlUX1NFVFRJTkcpLm1hcChpdGVtID0+IHsKICAgICAgICByZXR1cm4gVElNRV9MSU1JVF9TRVRUSU5HW2l0ZW1dLm5hbWU7CiAgICAgIH0pOwogICAgfSwKICAgIGN1cnJlbnREYXRlSW5kZXgoKSB7CiAgICAgIHJldHVybiB0aGlzLnRpbWVMaW1pdE5hbWVzLmluZGV4T2YodGhpcy50aW1lTGltaXQpOwogICAgfSwKICAgIGN1cnJlbnRUaW1lTGltaXRTZXR0aW5nKCkgewogICAgICByZXR1cm4gVElNRV9MSU1JVF9TRVRUSU5HW09iamVjdC5rZXlzKFRJTUVfTElNSVRfU0VUVElORylbdGhpcy5jdXJyZW50RGF0ZUluZGV4XV07CiAgICB9CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuZHJhd0JhcigpOwogIH0sCiAgbWV0aG9kczogewogICAgZHJhd0JhcigpIHsKICAgICAgLy8g5Z+65LqOZG9t77yM5Yid5aeL5YyWZWNoYXJ0c+WunuS+iwogICAgICBjb25zdCBiYXJHcmFwaCA9IGVjaGFydHMuaW5pdChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLmxpbmVDaGFydElkKSk7CiAgICAgIC8vIOe7mOWItuWbvuihqAogICAgICBiYXJHcmFwaC5zZXRPcHRpb24oewogICAgICAgIHRvb2x0aXA6IHsKICAgICAgICAgIHRyaWdnZXI6ICJheGlzIiwKICAgICAgICAgIGF4aXNQb2ludGVyOiB7CiAgICAgICAgICAgIHR5cGU6ICJjcm9zcyIsCiAgICAgICAgICAgIGxhYmVsOiB7CiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAiIzZhNzk4NSIKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgbGVnZW5kOiB7CiAgICAgICAgICBsZWZ0OiAiY2VudGVyIiwKICAgICAgICAgIGRhdGE6IFtdLAogICAgICAgICAgYm90dG9tOiAwCiAgICAgICAgfSwKICAgICAgICB4QXhpczogewogICAgICAgICAgdHlwZTogImNhdGVnb3J5IiwKICAgICAgICAgIG5hbWU6ICJ4IiwKICAgICAgICAgIHNwbGl0TGluZTogeyBzaG93OiBmYWxzZSB9LAogICAgICAgICAgZGF0YTogdGhpcy5saW5lQ2hhcnRUaW1lLAogICAgICAgICAgb2Zmc2V0OiAyMAogICAgICAgIH0sCiAgICAgICAgZ3JpZDogewogICAgICAgICAgbGVmdDogIjElIiwKICAgICAgICAgIHJpZ2h0OiAiMiUiLAogICAgICAgICAgYm90dG9tOiAiOCUiLAogICAgICAgICAgY29udGFpbkxhYmVsOiB0cnVlCiAgICAgICAgfSwKICAgICAgICB5QXhpczogewogICAgICAgICAgdHlwZTogInZhbHVlIiwKICAgICAgICAgIG5hbWU6ICLkvb/nlKjnjociLAogICAgICAgICAgYXhpc0xhYmVsOiB7CiAgICAgICAgICAgIHNob3c6IHRydWUsCiAgICAgICAgICAgIGludGVydmFsOiAiYXV0byIsCiAgICAgICAgICAgIGZvcm1hdHRlcjogInt2YWx1ZX0lIgogICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgc2VyaWVzOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG5hbWU6ICLkvb/nlKjnjociLAogICAgICAgICAgICB0eXBlOiAibGluZSIsCiAgICAgICAgICAgIGRhdGE6IHRoaXMubGluZUNoYXJ0RGF0YQogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfSk7CiAgICB9LAogICAgY2hhbmdlVGltZUxpbWl0KHZhbHVlKSB7CiAgICAgIHRoaXMudGltZUxpbWl0ID0gdmFsdWU7CiAgICAgIHRoaXMuZ2V0Q3VycmVudFNlcnZlck1vbml0b3JMb2dzKCk7CiAgICB9LAogICAgZ2V0Q3VycmVudFNlcnZlck1vbml0b3JMb2dzKCkgewogICAgICBnZXRNb25pdG9yTG9ncyh0aGlzLnNlcnZlckluZm8uaWQsIHsgYXM6IEpTT04uc3RyaW5naWZ5KHsgY3JlYXRlX2RhdGV0aW1lX19yYW5nZTogdGhpcy5jdXJyZW50VGltZUxpbWl0U2V0dGluZy50aW1lUmFuZ2UgfSkgfSkudGhlbihyZXN1bHRzID0+IHsKICAgICAgICB0aGlzLmxpbmVDaGFydERhdGEgPSByZXN1bHRzLmRhdGFbdGhpcy5saW5lQ2hhcnRLZXldOwogICAgICAgIHRoaXMubGluZUNoYXJ0VGltZSA9IHJlc3VsdHMuZGF0YVsiZGF0ZXRpbWUiXTsKICAgICAgICB0aGlzLmRyYXdCYXIoKTsKICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZyhlcnJvci5tc2cgfHwgYOiOt+WPliR7dGhpcy5jaGFydFRpdGxlfeaVsOaNruWksei0pe+8gWApOwogICAgICB9KTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["LineChart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LineChart.vue","sourceRoot":"src/views/admin/monitor/server/components","sourcesContent":["<template>\n  <div>\n    <div class=\"line-chart-title\">\n      <div class=\"line-chart-name\">{{ chartTitle }}</div>\n      <div class=\"line-chart-time-radio\">\n        <el-radio-group v-model=\"timeLimit\" @change=\"changeTimeLimit\">\n          <el-radio-button\n            v-for=\"item in Object.keys(TIME_LIMIT_SETTING)\"\n            :key=\"TIME_LIMIT_SETTING[item].key\"\n            :label=\"TIME_LIMIT_SETTING[item].name\"\n          />\n        </el-radio-group>\n      </div>\n    </div>\n    <div :id=\"lineChartId\" class=\"line-chart-body\" />\n  </div>\n</template>\n\n<script>\nimport VueTypes from \"vue-types\";\n// 引入基本模板,按需加载\nimport echarts from \"echarts\";\nimport moment from \"moment\";\nimport { getMonitorLogs } from \"@/api/admin/monitor/server\";\n\nconst TODAY = moment().format(\"YYYY-MM-DD\");\nconst YESTERDAY = moment().subtract(1, \"days\").format(\"YYYY-MM-DD\");\nconst LAST_SEVEN_DAYS = moment().subtract(7, \"days\").format(\"YYYY-MM-DD\");\nconst LAST_THIRTY_DAYS = moment().subtract(30, \"days\").format(\"YYYY-MM-DD\");\n\n// 时间段筛选配置\nconst TIME_LIMIT_SETTING = {\n  \"yesterday\": {\n    key: \"yesterday\",\n    name: \"昨天\",\n    timeRange: [\n      `${YESTERDAY} 00:00:00`,\n      `${YESTERDAY} 23:59:59`\n    ]\n  },\n  \"today\": {\n    key: \"today\",\n    name: \"今天\",\n    timeRange: [\n      `${TODAY} 00:00:00`,\n      `${TODAY} 23:59:59`\n    ]\n  },\n  \"latestWeek\": {\n    key: \"latestWeek\",\n    name: \"最近7天\",\n    timeRange: [\n      `${LAST_SEVEN_DAYS} 00:00:00`,\n      `${TODAY} 23:59:59`\n    ]\n  },\n  \"latestMonth\": {\n    key: \"latestMonth\",\n    name: \"最近30天\",\n    timeRange: [\n      `${LAST_THIRTY_DAYS} 00:00:00`,\n      `${TODAY} 23:59:59`\n    ]\n  }\n};\n// 默认显示时间\nconst DEFAULT_TIME = \"今天\";\n\nexport default {\n  name: \"LineChart\",\n  props: {\n    serverInfo: VueTypes.object.isRequired,\n    lineChartKey: VueTypes.string.isRequired,\n    chartTitle: VueTypes.string.isRequired,\n    chartData: VueTypes.array.isRequired,\n    chartTime: VueTypes.array.isRequired\n  },\n  data() {\n    return {\n      TIME_LIMIT_SETTING,\n      timeLimit: DEFAULT_TIME,\n      lineChartId: this.lineChartKey + \"Chart\",\n      lineChartData: this.chartData,\n      lineChartTime: this.chartTime\n    };\n  },\n  computed: {\n    timeLimitNames() {\n      return Object.keys(TIME_LIMIT_SETTING).map(item => {\n        return TIME_LIMIT_SETTING[item].name;\n      });\n    },\n    currentDateIndex() {\n      return this.timeLimitNames.indexOf(this.timeLimit);\n    },\n    currentTimeLimitSetting() {\n      return TIME_LIMIT_SETTING[Object.keys(TIME_LIMIT_SETTING)[this.currentDateIndex]];\n    }\n  },\n\n  mounted() {\n    this.drawBar();\n  },\n  methods: {\n    drawBar() {\n      // 基于dom，初始化echarts实例\n      const barGraph = echarts.init(document.getElementById(this.lineChartId));\n      // 绘制图表\n      barGraph.setOption({\n        tooltip: {\n          trigger: \"axis\",\n          axisPointer: {\n            type: \"cross\",\n            label: {\n              backgroundColor: \"#6a7985\"\n            }\n          }\n        },\n        legend: {\n          left: \"center\",\n          data: [],\n          bottom: 0\n        },\n        xAxis: {\n          type: \"category\",\n          name: \"x\",\n          splitLine: { show: false },\n          data: this.lineChartTime,\n          offset: 20\n        },\n        grid: {\n          left: \"1%\",\n          right: \"2%\",\n          bottom: \"8%\",\n          containLabel: true\n        },\n        yAxis: {\n          type: \"value\",\n          name: \"使用率\",\n          axisLabel: {\n            show: true,\n            interval: \"auto\",\n            formatter: \"{value}%\"\n          }\n        },\n        series: [\n          {\n            name: \"使用率\",\n            type: \"line\",\n            data: this.lineChartData\n          }\n        ]\n      });\n    },\n    changeTimeLimit(value) {\n      this.timeLimit = value;\n      this.getCurrentServerMonitorLogs();\n    },\n    getCurrentServerMonitorLogs() {\n      getMonitorLogs(this.serverInfo.id, { as: JSON.stringify({ create_datetime__range: this.currentTimeLimitSetting.timeRange }) }).then(results => {\n        this.lineChartData = results.data[this.lineChartKey];\n        this.lineChartTime = results.data[\"datetime\"];\n        this.drawBar();\n      }).catch(error => {\n        this.$message.warning(error.msg || `获取${this.chartTitle}数据失败！`);\n      });\n    }\n  }\n};\n</script>\n\n<style scoped>\n.line-chart-name {\n  font-weight: bolder;\n  width: 20%;\n  min-width: 30px;\n  text-align: left;\n  display: inline-block;\n}\n\n.line-chart-time-radio {\n  font-weight: bolder;\n  width: 80%;\n  min-width: 200px;\n  text-align: right;\n  display: inline-block;\n}\n\n.line-chart-body {\n  min-height: 300px;\n  min-width: 300px;\n}\n</style>\n"]}]}